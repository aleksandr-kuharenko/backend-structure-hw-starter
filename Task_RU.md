*Приветствую! Ты уже не понаслышке знаешь про структуру Backend'а, NodeJS и написание чистого, читабельного и качественного кода, но есть одно "но"... Не все проекты, которые будут встречаться на твоем пути, будут написаны разработчиками, которые знают про это столько же.*

## Задание
**Отрефакторить** [проект](https://github.com/aleksandr-kuharenko/backend-stucture-hw-starter), **сохранив** всю его функциональность (да-да, оно работает)

## Детали проекта 
- Проект имеет только backend часть 
- Весь функционал работает, и даже покрыт тестами. Как запустить сервер и автотесты ты узнаешь из [README.md](https://github.com/aleksandr-kuharenko/backend-stucture-hw-starter/blob/master/README.md)
- К сожалению, никакой документации и описанных требований к бизнес-логине нет... Зато есть код, а как говорят: `The code is the documentation`  
![meme](https://i.ibb.co/cN2CmJx/meme1.jpg)
- Помимо запуска автотестов, разобраться с бизнес-логикой тебе поможет Postman [коллекция](https://github.com/aleksandr-kuharenko/backend-stucture-hw-starter/tree/master/postman). Ти можешь импортировать её к себе в Postman, что бы увидеть примеры HTTP запросов и использовать их для мануального тестирования.
 
Технологии: 
- NodeJS + Express
- Postgres + [Knex](https://knexjs.org/)
- Docker
- [jsonwebtoken](https://www.npmjs.com/package/jsonwebtoken)
- [joi](https://www.npmjs.com/package/joi)
- [mocha](https://www.npmjs.com/package/mocha) (для тестов)

## Что нужно сделать:
1. Разбить код на слои (слой бизнес-логики, слой доступа к данным и т.д.)
2. Создать файловую структуру
3. Избавиться от дублирования кода
4. Избавиться от использования антипаттернов 
5. Исправить неоптимальные решения (лишние запросы в базу данных, ненужные циклы)

**Внимание**:
- index.js файл должен экспортировать instance Express сервера

Дополнительные задания:  

1. Подключить логгер (любой на [выбор](https://geshan.com.np/blog/2021/01/nodejs-logging-library/)). Для каждого запроса логировать:
    -  входные запросы: url запроса, метод, время получения запроса
    -  ответы сервера: url запроса, метод, время обработки запроса, http код ответа
2. При запуске сервера:
    - провалидировать все ли переменные среды указаны (если не все — вывести сообщение об ошибке, завершить Node процесс)
    - провалидировать подключение к базе данных (если подключиться не удалось — вывести сообщение об ошибке, завершить Node процесс)
3. Реализовать [graceful shutdown](https://medium.com/hackernoon/graceful-shutdown-in-nodejs-2f8f59d1c357) 
4. Настроить [pre-commit](https://dev.to/ajmaurya/set-up-eslint-prettier-and-pre-commit-hooks-using-husky-for-wordpress-from-scratch-1djk) hook, который будет запускать [eslint](https://eslint.org/)  

## Что будет оцениваться:

- Сохранение функциональности проекта
- Чистота, читабельность и качество коду

Максимальный балл: 9.  
Еще один балл можно получить за все выполненные дополнительные задания.

---

*Удачного рефакторинга!* 

![meme](https://i.ibb.co/ypLNpKN/refa.png)
